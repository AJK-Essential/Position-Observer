<link rel="stylesheet" href="./iframe.css" />
<body>
  <main>
    <div class="scroller" style="height: 70%; overflow: auto">
      <div
        style="
          height: 800px;
          width: 800px;
          display: flex;
          justify-content: center;
          align-items: center;
        "
      >
        <div class="target"></div>
      </div>
    </div>
  </main>
  <div class="overlay">
    <code>This overlay tracks the maroon target</code>
  </div>
  <div class="root-bounds"></div>
  <footer>
    <code></code>
    <div>
      <!--Uncomment the below code to see the root-bounds
      Warning, the root-bounds change quickly
      -->
      <label for="see-rootbounds">See RootBounds (Trigger Warning)</label>
      <input type="checkbox" class="root-bounds-checkbox" id="see-rootbounds" />
    </div>
  </footer>
  <script type="module">
    let target, overlay, code, rootBoundsDiv, targetBounds, rootBoundsSee;

    target = document.querySelector(".target");
    overlay = document.querySelector(".overlay");
    code = document.querySelector("footer code");
    rootBoundsDiv = document.querySelector(".root-bounds");

    rootBoundsSee = false;

    import { PositionObserver } from "./position-observer.js";

    const positionObserver = new PositionObserver(posObsCallback);
    positionObserver.observe(target);

    targetBounds = target.getBoundingClientRect();

    // Either the below callback or the event listener is called in these examples.
    function posObsCallback(data) {
      overlay.style.top = data.y + targetBounds.height + "px";
      overlay.style.left = data.x + "px";

      code.innerText = `Data.x\t:\t${data.x}\nData.y\t:\t${data.y}\nData.outOfViewport\t:\t${data.outOfViewport}`;

      rootBoundsDiv.style.left = data.rootBounds.left + "px";
      rootBoundsDiv.style.top = data.rootBounds.top + "px";
      rootBoundsDiv.style.height = data.rootBounds.height + "px";
      rootBoundsDiv.style.width = data.rootBounds.width + "px";
    }

    target.addEventListener(
      "movement-observed",
      (e) => {
        targetBounds = target.getBoundingClientRect();
        overlay.style.top = targetBounds.top + targetBounds.height + "px";
        overlay.style.left = targetBounds.left + "px";

        code.innerText = `Data.x\t:\t${targetBounds.x}\nData.y\t:\t${targetBounds.y}\nData.outOfViewport\t:\t${e.detail.outOfViewport}`;

        rootBoundsDiv.style.left = e.detail.rootBounds.left + "px";
        rootBoundsDiv.style.top = e.detail.rootBounds.top + "px";
        rootBoundsDiv.style.height = e.detail.rootBounds.height + "px";
        rootBoundsDiv.style.width = e.detail.rootBounds.width + "px";
      },
      { passive: true }
    );

    let rootBoundsCheckbox = document.querySelector(".root-bounds-checkbox");
    rootBoundsCheckbox.addEventListener("change", function () {
      // Check the 'checked' property to see if the box is currently checked
      rootBoundsSee = rootBoundsCheckbox.checked;
      rootBoundsDiv.style.display = rootBoundsCheckbox.checked
        ? "block"
        : "none";
    });
  </script>
</body>
